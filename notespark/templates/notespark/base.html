<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}NoteSpark{% endblock %}</title>
  <meta name="description" content="{% block description %}NoteSpark is a modern, open-source Markdown note app with offline-first support, secure vault, and fast downloads. GPLv3.{% endblock %}">
  <link rel="canonical" href="https://notespark.lusansapkota.com.np{% block canonical %}{% endblock %}">
  <link rel="icon" type="image/png" href="{{ url_for('notespark.static', filename='images/favicon.png') }}">
  
  <!-- Preload critical resources -->
  <link rel="preload" href="{{ url_for('notespark.static', filename='css/notespark.css') }}" as="style">
  <link rel="preload" href="{{ url_for('notespark.static', filename='js/notespark.js') }}" as="script">
  
  <!-- CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <link rel="stylesheet" href="{{ url_for('notespark.static', filename='css/notespark.css') }}">
  
  <style>
    :root {
      --glass-bg-light: rgba(255, 255, 255, 0.85);
      --glass-bg-dark: rgba(40, 40, 40, 0.85);
      --glass-border: rgba(255, 255, 255, 0.18);
      --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .theme-toggle-btn {
      border: none;
      background: transparent;
      font-size: 1.5rem;
      cursor: pointer;
      margin-left: 1rem;
      padding: 0.5rem;
      border-radius: 0.5rem;
      transition: var(--transition-smooth);
      position: relative;
      overflow: hidden;
    }

    .theme-toggle-btn:hover {
      background: rgba(0, 0, 0, 0.1);
      transform: scale(1.05);
    }

    .theme-toggle-btn:focus {
      outline: 2px solid var(--bs-primary);
      outline-offset: 2px;
    }

    .glass {
      background: var(--glass-bg-light);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-radius: 1rem;
      border: 1px solid var(--glass-border);
      box-shadow: var(--glass-shadow);
      transition: var(--transition-smooth);
    }

    [data-bs-theme="dark"] .glass {
      background: var(--glass-bg-dark);
      border-color: rgba(255, 255, 255, 0.1);
    }

    .glass:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 48px rgba(0, 0, 0, 0.15);
    }

    .navbar-brand {
      transition: var(--transition-smooth);
    }

    .navbar-brand:hover {
      transform: scale(1.02);
    }

    .nav-link {
      position: relative;
      transition: var(--transition-smooth);
      border-radius: 0.5rem;
      padding: 0.5rem 1rem !important;
      margin: 0 0.25rem;
    }

    .nav-link:hover {
      background: rgba(var(--bs-primary-rgb), 0.1);
      transform: translateY(-1px);
    }

    .nav-link.active {
      background: var(--bs-primary);
      color: white !important;
    }

    .nav-link.active:hover {
      background: var(--bs-primary);
      filter: brightness(1.1);
    }

    .hero-section {
      background: linear-gradient(135deg, 
        rgba(var(--bs-primary-rgb), 0.1) 0%,
        rgba(var(--bs-secondary-rgb), 0.05) 100%);
      border-radius: 2rem;
      margin: 2rem 0;
      padding: 4rem 2rem;
      position: relative;
      overflow: hidden;
    }

    .hero-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(0,0,0,0.03)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
      z-index: -1;
    }

    .hero-title {
      background: linear-gradient(135deg, var(--bs-primary), var(--bs-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: fadeInUp 1s ease-out;
    }

    .hero-subtitle {
      animation: fadeInUp 1s ease-out 0.3s both;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .fade-in {
      animation: fadeIn 0.6s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .footer-link {
      transition: var(--transition-smooth);
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
    }

    .footer-link:hover {
      background: rgba(var(--bs-primary-rgb), 0.1);
      transform: translateY(-1px);
    }

    /* Improved focus styles */
    .nav-link:focus,
    .navbar-brand:focus {
      outline: 2px solid var(--bs-primary);
      outline-offset: 2px;
    }

    /* Loading state */
    .loading {
      opacity: 0.7;
      pointer-events: none;
    }

    /* Responsive improvements */
    @media (max-width: 768px) {
      .hero-section {
        padding: 2rem 1rem;
        margin: 1rem 0;
      }
      
      .theme-toggle-btn {
        margin-left: 0.5rem;
      }
    }

    /* Reduce motion for accessibility */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
  </style>
  
  {% block head %}{% endblock %}
</head>
<body class="bg-body-secondary">
  <!-- Skip to main content link for accessibility -->
  <a href="#main-content" class="visually-hidden-focusable btn btn-primary">Skip to main content</a>
  
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light glass shadow-lg sticky-top rounded-4 py-2 px-2" aria-label="Main navigation" role="navigation">
    <div class="container-fluid">
      <a class="navbar-brand fw-bold fs-3 d-flex align-items-center gap-2" href="/" aria-label="NoteSpark Home">
        <img src="{{ url_for('notespark.static', filename='images/NoteSparkLogo.png') }}" 
             alt="NoteSpark Logo" 
             width="40" 
             height="40" 
             class="me-2 align-text-top rounded-circle shadow-sm"
             loading="lazy">
        <span class="d-none d-md-inline">NoteSpark</span>
      </a>

      <button class="navbar-toggler" 
              type="button" 
              data-bs-toggle="collapse" 
              data-bs-target="#navbarSupportedContent" 
              aria-controls="navbarSupportedContent" 
              aria-label="Toggle navigation"
              aria-expanded="false">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0 gap-1" role="menubar">
          <li class="nav-item" role="none">
        <a class="nav-link px-3 py-2 rounded-3 fw-semibold {% if request.path == url_for('notespark.index') %}active{% endif %}" 
           href="{{ url_for('notespark.index') }}" 
           role="menuitem"
           {% if request.path == url_for('notespark.index') %}aria-current="page"{% endif %}>Home</a>
          </li>
          <li class="nav-item" role="none">
        <a class="nav-link px-3 py-2 rounded-3 fw-semibold {% if request.path == url_for('notespark.about') %}active{% endif %}" 
           href="{{ url_for('notespark.about') }}" 
           role="menuitem"
           {% if request.path == url_for('notespark.about') %}aria-current="page"{% endif %}>About</a>
          </li>
          <li class="nav-item" role="none">
        <a class="nav-link px-3 py-2 rounded-3 fw-semibold {% if request.path == url_for('notespark.docs') %}active{% endif %}" 
           href="{{ url_for('notespark.docs') }}" 
           role="menuitem"
           {% if request.path == url_for('notespark.docs') %}aria-current="page"{% endif %}>Docs</a>
          </li>
          <li class="nav-item" role="none">
        <a class="nav-link px-3 py-2 rounded-3 fw-semibold {% if request.path == url_for('notespark.download') %}active{% endif %}" 
           href="{{ url_for('notespark.download') }}" 
           role="menuitem"
           {% if request.path == url_for('notespark.download') %}aria-current="page"{% endif %}>Download</a>
          </li>
          <li class="nav-item" role="none">
        <a class="nav-link px-3 py-2 rounded-3 fw-semibold {% if request.path == url_for('notespark.releases') %}active{% endif %}" 
           href="{{ url_for('notespark.releases') }}" 
           role="menuitem"
           {% if request.path == url_for('notespark.releases') %}aria-current="page"{% endif %}>Releases</a>
          </li>
        </ul>

        <button class="theme-toggle-btn ms-3" 
            id="themeToggle" 
            aria-label="Toggle color mode"
            title="Toggle color mode"></button>
          <span id="themeIcon" class="bi bi-brightness-high" aria-hidden="true"></span>
        </button>
      </div>
    </div>
  </nav>

  <!-- Hero/Header Section -->
  {% block header %}
  <section class="container fade-in">
    <div class="hero-section text-center">
      <h1 class="hero-title display-3 fw-bold mb-4">NoteSpark</h1>
      {% block subtitle %}
      <p class="hero-subtitle lead fs-4 mb-0">
        Modern, open-source Markdown note app.<br>
        <span class="text-muted">Secure, fast, offline-first.</span>
      </p>
      {% endblock %}
    </div>
  </section>
  {% endblock %}

  <!-- Main Content -->
  <main class="container my-4" id="main-content" tabindex="-1">
    {% block content %}{% endblock %}
  </main>

  <!-- Footer -->
  <footer class="glass mt-5 py-4 border-top" role="contentinfo">
    <div class="container d-flex flex-column flex-md-row justify-content-between align-items-center">
      <div class="mb-3 mb-md-0">
        <span class="fw-bold">NoteSpark</span> &copy; 2025. 
        <span class="text-muted">Licensed under GPLv3.</span>
      </div>
      <div class="d-flex flex-wrap gap-3 align-items-center">
        <a href="/privacy" class="footer-link text-decoration-none">Privacy Policy</a>
        <a href="https://github.com/Lusan-sapkota/notespark" 
           class="footer-link text-decoration-none" 
           target="_blank" 
           rel="noopener noreferrer"
           aria-label="View NoteSpark on GitHub (opens in new tab)">
          <i class="bi bi-github me-1" aria-hidden="true"></i>GitHub
        </a>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
  <script src="{{ url_for('notespark.static', filename='js/notespark.js') }}" defer></script>
  
  <!-- Enhanced Dark/Light Mode Toggle Script -->
  <script>
    (function() {
      'use strict';
      
      const themeToggle = document.getElementById('themeToggle');
      const themeIcon = document.getElementById('themeIcon');
      const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
      
      // Theme management
      function setTheme(theme) {
        const root = document.documentElement;
        root.setAttribute('data-bs-theme', theme);
        
        try {
          localStorage.setItem('theme', theme);
        } catch (e) {
          console.warn('Unable to save theme preference:', e);
        }
        
        // Update icon with animation
        themeIcon.style.transform = 'scale(0.8)';
        setTimeout(() => {
          themeIcon.className = theme === 'dark' ? 'bi bi-moon-stars' : 'bi bi-brightness-high';
          themeIcon.style.transform = 'scale(1)';
        }, 150);
        
        // Update button aria-label
        const label = theme === 'dark' ? 'Switch to light mode' : 'Switch to dark mode';
        themeToggle.setAttribute('aria-label', label);
        themeToggle.setAttribute('title', label);
      }
      
      function getStoredTheme() {
        try {
          return localStorage.getItem('theme');
        } catch (e) {
          return null;
        }
      }
      
      function getPreferredTheme() {
        const storedTheme = getStoredTheme();
        if (storedTheme) {
          return storedTheme;
        }
        return prefersDarkScheme.matches ? 'dark' : 'light';
      }
      
      // Initialize theme
      const currentTheme = getPreferredTheme();
      setTheme(currentTheme);
      
      // Theme toggle event listener
      themeToggle.addEventListener('click', () => {
        const current = document.documentElement.getAttribute('data-bs-theme');
        const newTheme = current === 'dark' ? 'light' : 'dark';
        setTheme(newTheme);
      });
      
      // Listen for system theme changes
      prefersDarkScheme.addEventListener('change', (e) => {
        if (!getStoredTheme()) {
          setTheme(e.matches ? 'dark' : 'light');
        }
      });
      
      // Keyboard support for theme toggle
      themeToggle.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          themeToggle.click();
        }
      });
      
      // Add smooth transitions after page load
      window.addEventListener('load', () => {
        document.body.style.transition = 'background-color 0.3s ease';
      });
      
    })();
  </script>
  
  {% block scripts %}{% endblock %}
</body>
</html>